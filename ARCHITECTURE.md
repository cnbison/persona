# Persona生成与应用平台架构设计

## 一、系统定位

本系统以 Persona 为核心资产，面向经典著作与教学内容的“活化理解”与“受众适配”。

- 说者Persona：默认作者Persona，可扩展讲解者/教师Persona
- 受众Persona：用于指导表达层级、术语密度与讲解方式
- 现阶段聚焦文本处理与可验证输出，未来扩展到多音色音频生成

## 二、架构总览

```
┌──────────────────────────────────────────────────────────┐
│                        桌面应用（Tauri）                   │
│  React UI: 上传/管理/构建/适配/诊断/导出                    │
└──────────────────────────────────────────────────────────┘
                    ↕ IPC/HTTP (localhost)
┌──────────────────────────────────────────────────────────┐
│                        Python 后端                        │
│  FastAPI API + Service 层 + Persona/证据库/适配逻辑         │
└──────────────────────────────────────────────────────────┘
                    ↕ 数据/文件
┌──────────────────────────────────────────────────────────┐
│  本地存储：SQLite（结构化数据） + 文件系统（文档/证据）      │
└──────────────────────────────────────────────────────────┘
                    ↕ 模型服务
┌──────────────────────────────────────────────────────────┐
│  LLM/Embedding：用于Persona建模、适配生成与诊断             │
└──────────────────────────────────────────────────────────┘
```

## 三、核心模块

- 文档解析与结构化：PDF/EPUB/文档清洗与章节拆分
- 证据库构建：观点-原文-上下文的可追溯链路
- 说者Persona建模：画像维度、边界规则、Persona卡片
- 受众Persona适配：表达分级、术语密度、结构偏好
- 输出与验证：提纲/对话/改写作为一致性验证任务
- 诊断与可解释：canonical/plan/final + 差异对比
- 资产化管理：Persona版本、导出/导入、复用

## 四、核心数据流

1. 文档上传与解析，生成章节与证据片段
2. 说者Persona构建并生成Persona卡片与边界规则
3. 受众Persona选择或创建，形成表达约束清单
4. 生成多版本输出（提纲/对话/改写）并进行诊断
5. 人工校准与回写，沉淀Persona与适配模板

## 五、关键数据模型（概念层）

- Book/Chapter：文档与章节结构
- Evidence：观点/原文/上下文证据
- SpeakerPersona：说者画像、维度、边界与证据引用
- AudiencePersona：受众画像、分级参数与约束
- OutputArtifact：提纲/对话/改写与其来源
- DiagnosticReport：一致性与适配评估结果

## 六、技术栈（当前）

- 前端：Tauri + React + TypeScript + TailwindCSS
- 后端：FastAPI + SQLAlchemy + SQLite
- 文档解析：pdfplumber / ebooklib
- NLP：jieba / TextRank（可替换为更强模型）
- 日志：loguru

## 七、扩展方向

- 音频生成：多音色/多语气的Persona音频输出
- 评估体系：可读性、理解题、术语覆盖度评估
- 跨场景复用：课程、研讨、导读、研究辅助

`style-generator/` 作为独立参考工程，仅借鉴其参数化思路与可视化表达，不改动其代码。
